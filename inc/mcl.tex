\chapter{移動ロボットの自己位置推定} \label{chapter:localization}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
本章では, Bayesian Filterによる移動ロボットの自己位置推定について定式化する. 
また, Bayesian Filterの実装方法の１つであるMonte Carlo Localization (以下MCL)について述べる. 
本論文においても, 移動ロボットの自己位置推定にはMCLが利用されるものとする. 

% Bayesian Filterによる状態推定では, ロボットはセンサにより得た情報や自身の制御出力の履歴から, 状態空間$\chi$内での現在の状態を確率的に推定する. 
% ロボットの状態を表すパラメータについては様々存在するが, 自己位置推定ではロボットの姿勢（位置と向き）を推定することを目的としている. 
% 本論文では, 二次元平面を低速で移動する対向二輪型のロボットを想定し, ロボットの二次元平面上における位置$x, y$と向き$\theta$をあわせた3次元の状態$(x, y, \theta)$の推定について扱う. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Bayesian Filterによる自己位置推定}

% Bayesian Filterによる自己位置推定では, 式(\ref{bayes theorem})に示すベイズの定理を用いて, 移動ロボットの位置を確率的に推定する. 
% ベイズの定理は, 事象$a, b$が起きる確率をそれぞれ$p(a), p(b)$としたときに, 
% \begin{equation}
% \label{bayes theorem}
%   y = a
% \end{equation}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Monte Carlo Localization (MCL)}

Monte Carlo Localization (MCL)は, Bayesian Filterを理論的背景としたロボットの自己位置推定手法の実装方法の１つである. 
MCLでは, 表現したい任意の空間上$\mathcal{X}$上に存在する確率密度関数を, 空間上に散布した標本により表現することで, ロボットの姿勢を確率的に推定する. 
この標本はパーティクル（粒子）と呼ばれ, ロボットの信念分布を表す確率密度関数$b_t(\bm{x})$を近似するように配置される. 
パーティクルはそれぞれパラメータとしてロボットと同次元の姿勢$\bm{x}$と重み$w$の情報を持っており, $N$個のパーティクルの集合は
\begin{equation}
\label{particles}
  \Xi_{t} = {\xi^{(i)}_{t} = (\bm{x}^{(i)}_{t}, w^{(i)}_{t} |i = 1,2,\dots,N) }
\end{equation}
のように定義される. 
基本的に全パーティクルの重みの合計は, 常に
\begin{equation}
\label{weight_sum}
  \sum_{i=1}^{N}w^{(i)}_{t}=1
\end{equation}
を保つように実装される. 

ロボットの状態を表すパラメータについては様々存在するが, 自己位置推定ではロボットの姿勢（位置と向き）を推定する. 
本論文では, 二次元平面を低速で移動する対抗二輪型の移動ロボットを想定し, ロボットの二次元平面上における位置$(x, y)$と向き$\theta$をあわせた3次元の状態$\bm{x} = (x, y, \theta)$の推定について扱う. 
したがって, ロボットの姿勢と同様に, パーティクルの姿勢はそれぞれ$\bm{x}^{(i)} = (x^{(i)}, y^{(i)}, \theta^{(i)})$となる. 

% MCLには大きな利点が2つある. 
% １つ目の利点は, \ref{section:backglound}でも述べたとおり, 多様な確率分布を表現できることである. 
% もう１つの利点は, アルゴリズムが簡単なことである. 
% したがって, 比較的容易に実装することが可能である. 

MCLのアルゴリズムは, 主に次の4ステップからなる. 
2から4を繰り返し行うことで逐次ロボットの姿勢を推定する. 
\begin{enumerate}
  \item 初期化
  \item 動作による更新
  \item 計測による更新
  \item リサンプリング
\end{enumerate}

% ロボットの真の姿勢を$\bm{m}^{*}$とすると, ある時刻$t$におけるロボットの信念分布は$bel_{t}$と表現され, 
% 本章のはじめで述べたとおり, 本論文では移動ロボットの姿勢$\bm{x} = (x, y, \theta)$を推定することを想定したMCLを述べる. 
% 各パーティクルはある時刻$t$におけるロボットの状態の具体的な事例であり, 真の状態に対する１つの仮説と考えることができる. 

% 標本はパーティクルと呼ばれる
% パーティクルはロボットの信念分布を近似するようにばらまかれる
% パーティクルは式で表現される
% 真の姿勢が存在する確率をしめす. 
% これをパーティクルで表現すると


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{初期化}

初期化のステップでは, パーティクルの初期化を行う. 
N個のパーティクルの初期姿勢$\bm{x}^{(i)}$を決定し, 重み$w^{(i)}$を$\frac{1}{N}$とする. 
パーティクルのばらまき方は, ロボットの初期の信念分布に従うように行う. 
一般的には, 以下のようなパーティクル初期姿勢の決定方法が用いられる. 

ロボットを人間が自由に配置する場合など, 初期姿勢が予め分かっている場合は, ロボットの信念分布をロボットが存在すると考えられる位置を平均とした正規分布と考え, 
パーティクルの初期姿勢$\bm{x}^{(i)}$を平均$\mu$, 分散$\Sigma$の正規分布に従うように決定する. 
本論文における移動ロボットの自己位置推定では, 状態$\bm{x}^{(i)}$が位置と向きからなる3次元のため, $\mu$と$\Sigma$はそれぞれ3次元ベクトル, $3\times3$の分散共分散行列として扱う. 
多くの場合$\mu$と$\Sigma$はヒューリスティックに決定する. 

一方, ロボットの初期位置が完全に不明なとき, ロボットの初期信念分布は状態空間$\mathcal{X}$全体の一様分布と考えられる. 
その場合は, パーティクルの姿勢は一様分布に従うように配置する. 

% MCLは, ロボットの制御出力や移動量, センサに含まれるノイズに頑健な推定が行える. 
% しかし, 想定を上回るノイズが混入した場合に, ロボットの真の姿勢$\bm{x}^{(*)}$とパーティクルの分布$\Xi$が大きく乖離することがある. 
% MCLでは, パーティクルの分布がロボットの真の位置$\bm{x}^{*}$がから大きく離れることがある. 
% このようなロボットの真の姿勢の周辺にパーティクルが存在しない状態は, 「誘拐状態」と呼ばれる. 
% 誘拐状態となったとき, 一般的にはふたたびパーティクルが真の姿勢周辺に戻ることは少ないとされ, 推定が大きく誤った状態が続く. 
% そこで, 融解状態から回復するための研究が複数行われている. 
% 本論文では, ロボット


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{動作による更新}

動作による更新のステップでは, Bayesian Filterにおける予測ステップを, 各パーティクルに対して行う. 
移動ロボットの状態遷移にはノイズが伴うため, 同様の制御入力でも試行ごとに異なる状態遷移結果となる. 
したがって, ロボットが動作すると信念分布が広がることになる. 
この広がった信念分布を表現するように, パーティクルの分布を更新する. 
各パーティクルの状態をロボットの動作モデル
ロボットの状態遷移確率$p(\bm{x} | \bm{x}_{t-1}, \bm{u}_{t})$とすると, 
動作後の各パーティクルの姿勢は
\begin{equation}
\label{particle trans prob}
  \bm{x}^{(i)}_{t} \sim p(\bm{x} | \bm{x}_{t-1}, \bm{u}_{t})
\end{equation}
のように更新される. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{計測による更新}

計測による更新のステップでは, Bayesian Filterにおける計測更新ステップを行う. 
センサにより得られた情報が, 各パーティクルの状態で得られる確率を計算し, 重み$w^{(i)}$を更新する. 
重みの更新はベイズの定理を用いて
\begin{equation}
\label{weight}
  w^{(i)}_{t} = q(\bm{z}_{t} | \bm{x}^{(i)}_{t}) \hat{w}^{(i)}_{t}
\end{equation}
のように計算される. 
尤度関数$q(z_{t} | \bm{x}^{(i)}_{t})$は, 使用するセンサの観測モデルをもとに決定する. 

現在, 移動ロボットの自己位置推定のために, LiDARと呼ばれる光センサによる測距センサや, RGB-Dカメラが広く利用されている. 
これらのセンサを自己位置推定位に用いるロボットは, 条件が揃えば非常に正確な推定を行うことが可能である. 
しかし, 本論文では移動ロボットの状態推定が不確かなときに有効となるような行動決定の手法を提案することを目的としている. 
したがって, 移動ロボットが曖昧にしか状態推定を行えない状況を想定するために, ロボットはこれらのセンサを搭載していないものとする. 

代わりに, ロボットはタスクの終了を検知することができるものとする. 
この仮定は, \ref{chapter:method}章で述べる提案手法, およびその先行研究となるPFC法で必要となる. 
ロボットは, 自身がゴールに到達したか否かを各ステップごとに知ることができ, その情報を計測による更新に用いることができるものとする. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{リサンプリング}
リサンプリングステップでは, パーティクルを再配置し重みを均一にする. 
再配置するパーティクルは, 重みに従った確率で選択される. 
重みの小さいパーティクルを間引き, 重みの大きいパーティクルの位置に多くのパーティクルを配置する. 
この操作により, 一箇所に重みが偏り続け推定の精度が下がることを防ぐ. 

パーティクルの選択（サンプリング）にはいくつかの手法が存在する. 
本論文では, 系統抽出法によるリサンプリングを用いる. 
